<?php ob_start('ob_gzhandler') ?>
<!DOCTYPE html >
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="viewport" content="width=device-width; height=device-height; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/>
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />    
<link rel="apple-touch-icon-precomposed" href="images/icon.png">
<link rel="icon" type="image/png" href="images/icon.png">

    <title>Hydra HVAC Temperature Sampler</title>

    <script src="javascript/jquery-1.4.4.js" ></script>
    <script src="javascript/RGraph.common.core.js" ></script>
    <script src="javascript/RGraph.line.js" ></script>
    <script src="javascript/RGraph.hprogress.js" ></script>
    <script src="javascript/RGraph.vprogress.js" ></script>

    <script>
        window.onload = function ()
        {
	     getData();
	 }
      
function getData() {
    $.ajax({
	 url: '../thermometerdata/',
	 type: 'GET',
	 dataType: 'text',
	 timeout: 1000,
	 error: function(){
	     setTimeout("getData();", 10000);
	 },
	 success: function(json){
	     drawChart(json);
	     setTimeout("getData();", 1000);
	 }
    });
}

function drawChart (json) {
    var data = eval('(' + json + ')');
    //data = {'ids': ['abc','def','gj'], 'data': [[30,30,30,30], [35,25,35,35], [33,33,33,33]]};
    
    var line1 = new RGraph.Line('line1', data['data'].slice(-50));
    RGraph.Clear(line1.canvas);
    line1.Set('chart.title', 'Hydra HVAC');
    // var labels = []
    // for (int i = 0; i < data['ids'].length; i++) {
    // 	 labels[2*i] = 0;
    // 	 labels[2*i + 1] = data['ids'][i];
    // }
    // line1.Set('chart.labels.ingraph', [0 ,'foo', 3 ,'nar', 3 , 'nax']);
    line1.Set('chart.colors', ['red', 'blue']);
    // line1.Set('chart.tickmarks', ['circle', 'square']);
    line1.Set('chart.linewidth', 1);
    // line1.Set('chart.background.barcolor1', 'white');
    //  line1.Set('chart.background.barcolor2', 'white');
    line1.Set('chart.background.grid.autofit', true);
    //line1.Set('chart.fillstyle', ['#fcc', '#cfc']);
    
    line1.Set('chart.text.angle', 45);
    line1.Set('chart.gutter', 45);
    line1.Set('chart.units.post', '\u00B0C');
    line1.Set('chart.noaxes', true);
    line1.Set('chart.background.grid', true);
    line1.Set('chart.yaxispos', 'right');
    line1.Set('chart.ymax', 35);
    line1.Set('chart.ymin', 25);
    line1.Set('chart.title.xaxis', 'Time');
    line1.Set('chart.title.yaxis', 'Temperature');
    line1.Set('chart.title.xaxis.pos', 0.5);
    line1.Set('chart.title.yaxis.pos', 0.5);
    line1.Set('chart.key', ['Tin', 'Tout']);
    line1.Draw();
    
     	
     var colors = ['red'];
     var value = 15;
     if (data['battery'] == 'Medium') {
     	colors = ['yellow'];
     	value = 50;
     }
     if (data['battery'] == 'High') {
     	colors = ['green'];
     	value = 90;
     }
     var progress1 = new RGraph.VProgress('progress1', value, 100);
     RGraph.Clear(progress1.canvas);
     progress1.Set('chart.colors', colors);
     
     progress1.Set('chart.tickmarks', false);
     progress1.Set('chart.margin', 3);
     //progress1.Set('chart.tickmarks.inner', true);
     //       progress1.Set('chart.label.inner', true);
            progress1.Set('chart.gutter', 30);
     //       progress1.Set('chart.units.post', '%');
            
      progress1.Draw();
}
    </script>
</head>
<body>
    <div>
    <canvas id="line1" width="400" height="300">[Please wait...]</canvas>
    <canvas id="progress1" width="50" height="200">[Please wait...]</canvas>
    </div>
</body>
</html>
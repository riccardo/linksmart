<?xml version="1.0" encoding="UTF-8"?>

<!-- Build file for NetworkManager
	 author: Marco Tiemann -->

<!--
		The following properties must be pre-defined in the parent ant script:
		- javaLibDir directory containing 3rd party Java libraries -
		rootBuildDir base directory for all intermediate outputs -
		rootDistributionDir directory for compiled bundles
	-->

<project name="NetworkManager" default="fail" xmlns:ivy="antlib:org.apache.ivy.ant">

	<!-- properties -->
	<property name="moduleName" value="NetworkManagerTesting" />
	<property name="revision" value="1.0.0" />
	<property name="src.dir" value="${basedir}/src" />
	<property name="lib.dir" value="${basedir}/lib" />
	<property name="build.dir" value="${rootBuildDir}/test/${moduleName}/bin" />
	<property name="src.dist.dir" value="${basedir}/../../../distribution" />
	<property name="targetPlatform.dir" value="${basedir}/../../target_platform" />
	<property name="targetPlatform.test.dir" value="${basedir}/../target_platform_test" />

	<!-- paths -->

	<path id="classpath">
		<fileset dir="${lib.dir}">
			<include name="**/*.jar" />
		</fileset>
		<fileset dir="${targetPlatform.dir}">
			<include name="**/*.jar" />
		</fileset>
		<fileset dir="${targetPlatform.test.dir}">
			<include name="**/*.jar" />
		</fileset>
		<fileset dir="${basedir}/../../../distribution">
			<include name="**/*.jar" />
		</fileset>
		<pathelement path="${build.dir}" />
	</path>

	<!-- targets -->

	<!-- default target fails -->
	<target name="fail">
		<fail message="please use the root ant build file" />
	</target>

	<!-- set up build environment -->
	<target name="resolve">
		<echo message="Setting up build environment" />
		<ivy:resolve transitive="true" />
		<ivy:retrieve transitive="true" type="jar" pattern="${targetPlatform.test.dir}/[artifact]-[revision].[ext]" />
		<ivy:retrieve transitive="true" type="jars" pattern="${targetPlatform.test.dir}/[artifact]-[revision].[ext]" />
		<ivy:retrieve transitive="true" type="bundle" pattern="${targetPlatform.test.dir}/[artifact]-[revision].[ext]" />
	</target>

	<!-- build -->
	<target name="build">
		<echo message="Compiling" />
		<mkdir dir="${build.dir}" />
		<javac destdir="${build.dir}" classpathref="classpath">
			<src path="${src.dir}" />
		</javac>
	</target>

	<!-- test -->
	<target name="test" depends="resolve">
		<echo message="Testing" />
		<junit fork="yes" haltonfailure="yes">
		    <batchtest fork="yes">
		      <fileset dir="${build.dir}">
		        <include name="**/*Test.class" />
		      </fileset>
		    </batchtest>
			<formatter type="plain" usefile="false" />
			<classpath refid="classpath" />
		</junit>
	</target>

</project>
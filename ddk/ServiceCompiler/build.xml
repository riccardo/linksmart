<!--
  Copyright (C) 2006-2010 
                          the HYDRA consortium, EU project IST-2005-034891
  
  This file is part of LinkSmart.
  
  LinkSmart is free software: you can redistribute it and/or modify
  it under the terms of the GNU LESSER GENERAL PUBLIC LICENSE
  version 3 as published by the Free Software Foundation.
  
  LinkSmart is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Lesser General Public License for more details.
  
  You should have received a copy of the GNU Lesser General Public
  License along with LinkSmart.  If not, see <http://www.gnu.org/licenses/>.
-->
<project name="ServiceCompiler" basedir="." default="make">
  <property name="bin" location="bin"/>
  <property name="sc.distribution.dir" value="${basedir}/../../distribution/ServiceCompiler"/>

  <target name="clean">
    <ant dir="sc_framework" target="clean"/>

    <!-- SIC: cannot use subant -->
    <ant dir="sc_plugins/sc_client/" target="clean"/>
    <ant dir="sc_plugins/sc_eclipse/" target="clean"/>
    <ant dir="sc_plugins/sc_linksmart/" target="clean"/>
    <ant dir="sc_plugins/sc_ontology/" target="clean"/>
    <ant dir="sc_plugins/sc_osgi/" target="clean"/>
    <ant dir="sc_plugins/sc_protocols/" target="clean"/>
    <ant dir="sc_plugins/sc_server/" target="clean"/>
    <ant dir="sc_plugins/sc_server_standalone/" target="clean"/>
    <ant dir="sc_plugins/sc_soap/" target="clean"/>
    <ant dir="sc_plugins/sc_upnp/" target="clean"/>

    <ant dir="sc_runtime/sc_http_service/" target="clean"/>
    <ant dir="sc_runtime/sc_tcp_protocol/" target="clean"/>
    <ant dir="sc_runtime/sc_udp_protocol/" target="clean"/>

  </target>


  <target name="make-local">
    <property name="antlib.dir" value="${basedir}/../../antlibs"/>
    <property name="rootBuildDir" value="${basedir}/../../build"/>
    <property name="rootDistributionDir" value="${basedir}/../../distribution"/>
    <path id="antlib.path">
      <fileset dir="${antlib.dir}" includes="*.jar"/>
    </path>
    <taskdef resource="org/apache/ivy/ant/antlib.xml" uri="antlib:org.apache.ivy.ant" classpathref="antlib.path"/>
    <taskdef resource="aQute/bnd/ant/taskdef.properties" classpathref="antlib.path"/> 
    <antcall target="make"/>
  </target>

  <target name="make">
    <ant dir="sc_framework" target="make"/>

    <!-- SIC: cannot use subant -->
    <ant dir="sc_plugins/sc_client/" target="make"/>
    <ant dir="sc_plugins/sc_eclipse/" target="make"/>
    <ant dir="sc_plugins/sc_linksmart/" target="make"/>
    <ant dir="sc_plugins/sc_ontology/" target="make"/>
    <ant dir="sc_plugins/sc_osgi/" target="make"/>
    <ant dir="sc_plugins/sc_protocols/" target="make"/>
    <ant dir="sc_plugins/sc_server/" target="make"/>
    <ant dir="sc_plugins/sc_server_standalone/" target="make"/>
    <ant dir="sc_plugins/sc_soap/" target="make"/>
    <ant dir="sc_plugins/sc_upnp/" target="make"/>

    <ant dir="sc_runtime/sc_http_service/" target="make"/>
    <ant dir="sc_runtime/sc_tcp_protocol/" target="make"/>
    <ant dir="sc_runtime/sc_udp_protocol/" target="make"/>

    <copy todir="${sc.distribution.dir}">
      <fileset dir="resources/deployment/"/>
    </copy>
    <delete>
      <fileset dir="${sc.distribution.dir}" 
		 includes="sc_http_service.jar,sc_*_protocol.jar"/>
    </delete>
    <move todir="${sc.distribution.dir}/bundle/" flatten="true">
      <fileset dir="${sc.distribution.dir}" includes="sc_*.jar"/>
    </move>
  </target>
</project>
